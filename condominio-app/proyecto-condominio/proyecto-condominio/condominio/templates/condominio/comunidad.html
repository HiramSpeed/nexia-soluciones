{% extends 'condominio/_base.html' %}

{% block content %}
<div class="max-w-7xl mx-auto">

    <div class="flex flex-col md:flex-row justify-between items-center mb-8 bg-indigo-600 p-6 rounded-lg text-white shadow-lg">
        <div>
            <h1 class="text-3xl font-bold">ğŸ¤ Comunidad Villa Catania</h1>
            <p class="opacity-90 mt-1">Apoya la economÃ­a local y conecta con tus vecinos.</p>
        </div>
        <div class="mt-4 md:mt-0">
            {% if mi_servicio %}
                <a href="{% url 'condominio:publicar_servicio' %}" class="bg-white text-indigo-700 font-bold py-2 px-4 rounded shadow hover:bg-gray-100">
                    âœï¸ Editar mi Anuncio
                </a>
            {% else %}
                <a href="{% url 'condominio:publicar_servicio' %}" class="bg-yellow-400 text-indigo-900 font-bold py-2 px-4 rounded shadow hover:bg-yellow-300">
                    ğŸ“¢ Â¡AnÃºnciate AquÃ­!
                </a>
            {% endif %}
        </div>
    </div>

    <div class="mb-10">
        <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
            ğŸ† Vecinos MÃ¡s Reconocidos
            <span class="text-xs font-normal text-gray-500 bg-gray-200 px-2 py-1 rounded">Ayudan y participan</span>
        </h2>
        <div class="grid grid-cols-2 md:grid-cols-5 gap-4">
            {% for vecino in top_vecinos %}
                <div class="bg-white p-4 rounded-lg shadow text-center border-t-4 border-yellow-400">
                    <div class="text-2xl mb-1">ğŸ¡</div>
                    <h3 class="font-bold text-gray-700">Casa {{ vecino.numero_casa }}</h3>
                    <div class="flex justify-center items-center gap-1 text-orange-500 font-bold mt-2">
                        <svg class="w-5 h-5 fill-current" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>
                        {{ vecino.estrellas }}
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>

    <h2 class="text-xl font-bold text-gray-800 mb-4">ğŸª Mercado Vecinal y Oficios</h2>
    <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-6">
        {% for servicio in servicios %}
        <div class="bg-white rounded-lg shadow-md overflow-hidden hover:shadow-xl transition duration-300 flex flex-col">
            <div class="h-40 bg-gray-200 overflow-hidden relative">
                {% if servicio.imagen_promo %}
                    <img src="{{ servicio.imagen_promo.url }}" class="w-full h-full object-cover">
                {% else %}
                    <div class="flex items-center justify-center h-full text-4xl">
                        {% if servicio.categoria == 'Oficio' %}ğŸ› ï¸{% elif servicio.categoria == 'Comida' %}ğŸ”{% else %}ğŸ“¦{% endif %}
                    </div>
                {% endif %}
                <span class="absolute top-2 right-2 bg-black bg-opacity-60 text-white text-xs px-2 py-1 rounded">
                    Casa {{ servicio.casa.numero_casa }}
                </span>
            </div>

            <div class="p-4 flex-grow">
                <div class="text-xs font-bold text-indigo-600 uppercase tracking-wide mb-1">{{ servicio.get_categoria_display }}</div>
                <h3 class="font-bold text-lg text-gray-900 mb-2 leading-tight">{{ servicio.titulo }}</h3>
                <p class="text-gray-600 text-sm mb-4 line-clamp-3">{{ servicio.descripcion }}</p>

                <a href="https://wa.me/521{{ servicio.telefono_contacto }}?text=Hola,%20soy%20tu%20vecino%20de%20la%20casa%20{{ user.casa.numero_casa }},%20vi%20tu%20anuncio%20en%20la%20App" target="_blank" class="block w-full bg-green-500 hover:bg-green-600 text-white text-center font-bold py-2 rounded transition flex justify-center items-center gap-2">
                    <svg class="w-4 h-4 fill-current" viewBox="0 0 24 24"><path d="M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.481 5.236 3.48 8.414-.003 6.557-5.338 11.892-11.893 11.892-1.99-.001-3.951-.5-5.688-1.448l-6.305 1.654zm6.597-3.807c1.676.995 3.276 1.591 5.392 1.592 5.448 0 9.886-4.434 9.889-9.885.002-5.462-4.415-9.89-9.881-9.892-5.452 0-9.887 4.434-9.889 9.884-.001 2.225.651 3.891 1.746 5.634l-.999 3.648 3.742-.981zm11.387-5.464c-.074-.124-.272-.198-.57-.347-.297-.149-1.758-.868-2.031-.967-.272-.099-.47-.149-.669.149-.198.297-.768.967-.941 1.165-.173.198-.347.223-.644.074-.297-.149-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.297-.347.446-.521.151-.172.2-.296.3-.495.099-.198.05-.372-.025-.521-.075-.148-.669-1.611-.916-2.206-.242-.579-.487-.501-.669-.51l-.57-.01c-.198 0-.52.074-.792.372s-1.04 1.016-1.04 2.479 1.065 2.876 1.213 3.074c.149.198 2.095 3.2 5.076 4.487.709.306 1.263.489 1.694.626.712.226 1.36.194 1.872.118.571-.085 1.758-.719 2.006-1.413.248-.695.248-1.29.173-1.414z"/></svg>
                    Contactar
                </a>
            </div>

            <div class="bg-gray-50 p-3 border-t border-gray-100 flex justify-between items-center text-xs">
                <span class="text-gray-500">Â¿Recomiendas a este vecino?</span>
                <a href="{% url 'condominio:dar_reconocimiento' servicio.casa.id %}" class="text-yellow-600 hover:text-yellow-800 font-bold flex items-center gap-1">
                    â­ Dar Estrella
                </a>
            </div>
        </div>
        {% empty %}
            <div class="col-span-full text-center py-12">
                <p class="text-gray-500 text-lg">AÃºn no hay servicios publicados. Â¡SÃ© el primero!</p>
                <a href="{% url 'condominio:publicar_servicio' %}" class="mt-4 inline-block text-indigo-600 underline">Publicar mi servicio</a>
            </div>
        {% endfor %}
    </div>
</div>
{% endblock %}